<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0a07" />
  <title>Александр Елфимов — Аналитик • Middle‑earth Edition</title>
  <meta name="description" content="Аналитик данных / BI с опытом Power BI, Excel, Python, SQL. Портфолио и резюме в эстетике Властелина колец с премиальными анимациями." />
  <meta property="og:title" content="Александр Елфимов — Аналитик / BI" />
  <meta property="og:description" content="Портфолио и резюме в эстетике Middle‑earth: опыт, навыки, PDF, контакты." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="assets/img/og-cover.jpg" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Favicon / meta -->
  <link rel="icon" type="image/svg+xml" href="assets/icons/ring.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <!-- Google Fonts (fallback к Cinzel/Inter, если кастомные недоступны) -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Preload локальных шрифтов (relative paths for GH Pages) -->
  <link rel="preload" as="font" href="fonts/Ringbearer.woff2" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="fonts/SauronKing.woff2" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="fonts/ElvishRingNFI.woff2" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="fonts/FlareSerif821.woff2" type="font/woff2" crossorigin>

  <style>
    :root { /* THEME: Shire (light) */
      --bg: #0b0a07; --paper: #12100e; --ink: #f6e7c1; --accent: #d1a954; --accent-2: #6b8f57;
      --muted: #b1a68b; --shadow: rgba(0,0,0,.5); --ring-glow: #ffcc44; --outline: rgba(209,169,84,.4);
      --soft: cubic-bezier(.25,.1,.25,1); --radius: 18px;
      --elev-1: 0 6px 24px rgba(0,0,0,.3);
      --elev-2: 0 10px 40px rgba(0,0,0,.35);
    }
    [data-theme="mordor"]{ --paper:#0b0a07; --ink:#e8dcc3; --accent:#f39c12; --accent-2:#9b2915; --muted:#988a6b; --ring-glow:#ffa300; --outline:rgba(243,156,18,.35); }

    /* ========= FONTS ========= */
    @font-face{font-family:'Ringbearer';src:url('fonts/Ringbearer.woff2') format('woff2'),url('fonts/Ringbearer.woff') format('woff');font-display:swap}
    @font-face{font-family:'SauronKing';src:url('fonts/SauronKing.woff2') format('woff2'),url('fonts/SauronKing.woff') format('woff');font-display:swap}
    @font-face{font-family:'ElvishRingNFI';src:url('fonts/ElvishRingNFI.woff2') format('woff2'),url('fonts/ElvishRingNFI.woff') format('woff');font-display:swap}
    @font-face{font-family:'FlareSerif821';src:url('fonts/FlareSerif821.woff2') format('woff2'),url('fonts/FlareSerif821.woff') format('woff');font-display:swap}

    /* ========= RESET / BASE ========= */
    *{box-sizing:border-box} html,body{height:100%} html{scroll-behavior:smooth}
    body{margin:0;color:var(--ink);background:var(--bg);font-family:Inter, FlareSerif821, serif;line-height:1.6;overflow-x:hidden}
    .noise{position:fixed;inset:0;pointer-events:none;opacity:.08;mix-blend-mode:soft-light;background-image:repeating-radial-gradient(circle at 20% 30%, rgba(255,255,255,.08) 0 2px, transparent 2px 6px),repeating-radial-gradient(circle at 80% 70%, rgba(0,0,0,.08) 0 2px, transparent 2px 6px);z-index:2}
    .texture{position:fixed;inset:0;background:radial-gradient(1200px 800px at 50% -10%, rgba(209,169,84,.08),transparent 60%),radial-gradient(800px 600px at 80% 120%, rgba(107,143,87,.06),transparent 60%),url('assets/img/texture-parchment.jpg');background-size:cover;background-blend-mode:multiply;opacity:.42;pointer-events:none;z-index:1}
    a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}

    /* ========= LAYOUT ========= */
    .nav{position:sticky;top:0;z-index:40;backdrop-filter:blur(8px);background:linear-gradient(to bottom, rgba(0,0,0,.6), rgba(0,0,0,0));border-bottom:1px solid var(--outline)}
    .nav-inner{max-width:1160px;margin:0 auto;padding:14px 20px;display:flex;align-items:center;gap:12px}
    .brand{font-family:Ringbearer, Cinzel, serif;letter-spacing:.02em;font-size:22px;color:var(--ink)} .spacer{flex:1}
    .btn{position:relative;overflow:hidden;appearance:none;border:1px solid var(--outline);background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.2));color:var(--ink);padding:8px 14px;border-radius:999px;cursor:pointer;transition:transform .2s var(--soft)}
    .btn:hover{transform:translateY(-1px)} .btn::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transform:translateX(-120%)}
    .btn:hover::after{animation:sheen 1.2s ease}

    .section{position:relative;padding:80px 20px} .container{max-width:1160px;margin:0 auto}

    /* ========= PARALLAX DECOR ========= */
    .parallax{position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.32}
    .p-layer{position:absolute;max-width:60vw;filter:drop-shadow(0 6px 20px rgba(0,0,0,.35));will-change:transform}
    .p-layer.leaves{right:-6vw;top:-4vh;width:42vw;opacity:.5} .p-layer.map{left:-8vw;bottom:-6vh;width:52vw;opacity:.38}

    /* ========= HERO ========= */
    .hero{min-height:86vh;display:grid;place-items:center;background:radial-gradient(1200px 700px at 50% 0%, rgba(209,169,84,.08), transparent 70%)}
    .hero-card{position:relative;display:grid;gap:18px;grid-template-columns:160px 1fr;align-items:center;width:100%;max-width:980px;padding:22px;border-radius:var(--radius);background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.25)),url('assets/stencils/border.svg');background-size:cover;background-blend-mode:soft-light;border:1px solid var(--outline);box-shadow:var(--elev-2);overflow:hidden}
    .hero-card::after{content:"";position:absolute;inset:0;pointer-events:none;box-shadow:inset 0 0 0 1px rgba(255,255,255,.04);border-radius:inherit}
    .hero-card::before{content:"";position:absolute;inset:-1px;padding:1px;border-radius:inherit;background:conic-gradient(from 120deg at 50% 50%, rgba(209,169,84,0), rgba(209,169,84,.25), rgba(209,169,84,0) 60%);mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude;animation:sheen 6s ease-in-out infinite}
    @keyframes sheen{0%{transform:translateX(-30%);opacity:0}30%{opacity:.9}100%{transform:translateX(110%);opacity:0}}

    .portrait{width:160px;height:200px;border-radius:14px;object-fit:cover;border:1px solid var(--outline);filter:saturate(.92) contrast(1.05)}
    .hero-body{padding:4px 6px}
    .title{font-family:Ringbearer, Cinzel, serif;font-size:clamp(26px,4.2vw,44px);line-height:1.1;letter-spacing:.02em;margin:0}
    .motto{margin:6px 0 0;font-family:ElvishRingNFI, Cinzel, serif;letter-spacing:.08em;color:var(--accent);opacity:.9;text-shadow:0 0 14px rgba(209,169,84,.28)}
    .subtitle{font-family:FlareSerif821, Cinzel, serif;font-weight:600;color:var(--muted);margin:8px 0 0}
    .badges{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px} .badge{border:1px solid var(--outline);padding:8px 12px;border-radius:999px;background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.25));font-size:13px}

    .cta{display:flex;gap:12px;margin-top:22px;flex-wrap:wrap}
    .button{position:relative;overflow:hidden;border:1px solid var(--outline);padding:12px 18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.35));color:var(--ink);font-weight:600;letter-spacing:.02em;transition:transform .25s var(--soft), box-shadow .25s var(--soft)}
    .button:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(209,169,84,.18)} .button::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.16),transparent);transform:translateX(-120%)} .button:hover::after{animation:sheen 1.1s ease}
    .button.is-primary{background:radial-gradient(120% 220% at 50% 0%, rgba(209,169,84,.35), rgba(0,0,0,.2))}

    /* ========= GRID SECTIONS ========= */
    .grid{display:grid;gap:22px;grid-template-columns:1fr 1fr}
    .card{border:1px solid var(--outline);border-radius:var(--radius);background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.25));padding:20px;box-shadow:var(--elev-1)}
    .h2{font-family:SauronKing, Ringbearer, Cinzel, serif;letter-spacing:.02em;font-size:clamp(22px,2.2vw,30px);margin:0 0 12px}
    .list{margin:0;padding:0 0 0 18px} .list li{margin:8px 0}
    .kv{display:grid;gap:8px;grid-template-columns:160px 1fr;align-items:start} .kv strong{color:var(--accent)}

    /* ========= RING FLOAT BTN ========= */
    .to-top{position:fixed;right:18px;bottom:18px;z-index:30;opacity:0;visibility:hidden;transition:opacity .4s var(--soft), transform .4s var(--soft);transform:translateY(10px)}
    .to-top.show{opacity:1;visibility:visible;transform:none}
    .to-top .button{border-radius:999px}

    /* ========= PRELOADER ========= */
    .preloader{position:fixed;inset:0;z-index:50;display:grid;place-items:center;background:radial-gradient(1200px 700px at 50% -10%, rgba(209,169,84,.1), transparent 70%), #0b0a07;transition:opacity .7s var(--soft), visibility .7s var(--soft)}
    .preloader.hidden{opacity:0;visibility:hidden;pointer-events:none}

    .ring-wrap{position:relative;width:min(56vh,520px);aspect-ratio:1/1;filter:drop-shadow(0 20px 40px rgba(209,169,84,.25))}
    .ring{width:100%;height:100%}
    .ring .gold{stroke:url(#gold);stroke-width:18;fill:none;filter:url(#blurGlow)}
    .ring .text{font-family:ElvishRingNFI, Cinzel, serif;fill:var(--ring-glow);font-size:22px;letter-spacing:.06em}
    .ring-rot{animation:spin 9s linear infinite;transform-origin:50% 50%}
    @keyframes spin{to{transform:rotate(360deg)}}

    .progress{position:absolute;inset:auto 0 10%;display:grid;place-items:center;text-align:center}
    .progress .bar{width:240px;height:6px;border:1px solid var(--outline);border-radius:6px;overflow:hidden;margin:12px auto 8px;background:rgba(255,255,255,.06)}
    .progress .bar>i{display:block;height:100%;width:0%;background:linear-gradient(90deg, rgba(209,169,84,.1), rgba(209,169,84,.55));box-shadow:0 0 16px rgba(209,169,84,.45) inset;transition:width .3s var(--soft)}
    .progress .label{color:var(--muted);font-family:FlareSerif821, Inter, serif;font-size:14px}

    /* ========= REVEAL ANIMS ========= */
    [data-reveal]{opacity:0;transform:translateY(14px);transition:opacity .8s var(--soft), transform .8s var(--soft)}
    [data-reveal].revealed{opacity:1;transform:translateY(0)}

    /* ========= RESPONSIVE ========= */
    @media (max-width:820px){.hero-card{grid-template-columns:1fr;text-align:center}.portrait{margin:0 auto}.grid{grid-template-columns:1fr}}
    @media (prefers-reduced-motion:reduce){.ring-rot{animation:none}.button,[data-reveal]{transition:none!important}}

    /* ========= PRINT (резюме красиво на бумаге) ========= */
    @media print{
      body{background:#fff;color:#000}
      .preloader,.parallax,.noise,.texture,.to-top{display:none!important}
      .section{padding:24px 0}
      a{color:#000}
    }
  </style>
</head>
<body>
  <!-- PARALLAX DECOR (под трафареты) -->
  <div class="parallax" aria-hidden="true">
    <img class="p-layer leaves" src="assets/stencils/leaves.svg" alt="" loading="lazy" />
    <img class="p-layer map" src="assets/stencils/map.svg" alt="" loading="lazy" />
  </div>

  <!-- PRELOADER -->
  <div class="preloader" id="preloader" aria-label="Загрузка">
    <div class="ring-wrap">
      <svg class="ring" viewBox="0 0 600 600" aria-hidden="true">
        <defs>
          <linearGradient id="gold" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#7a5b1c"/>
            <stop offset="40%" stop-color="#d1a954"/>
            <stop offset="70%" stop-color="#f7d77a"/>
            <stop offset="100%" stop-color="#7a5b1c"/>
          </linearGradient>
          <filter id="blurGlow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="3" result="b"/>
            <feMerge>
              <feMergeNode in="b"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
          <path id="circle" d="M300,40 a260,260 0 1,1 0,520 a260,260 0 1,1 0,-520"/>
        </defs>
        <circle cx="300" cy="300" r="260" class="gold ring-rot" />
        <text class="text">
          <textPath href="#circle" startOffset="0%" class="ring-rot">Ash nazg durbatulûk • ash nazg gimbatul • ash nazg thrakatulûk • agh burzum‑ishi krimpatul • </textPath>
        </text>
      </svg>
      <div class="progress">
        <div class="bar" aria-hidden="true"><i id="progressBar"></i></div>
        <div class="label"><span id="progressNum">0</span>% — Куется ваше Кольцо</div>
      </div>
    </div>
  </div>

  <!-- NAV -->
  <header class="nav">
    <div class="nav-inner container">
      <div class="brand">A. Elfimov</div>
      <div class="spacer"></div>
      <button class="btn" id="audioToggle" aria-label="Управление звуком">Звук: Выкл</button>
      <button class="btn" id="themeToggle" aria-label="Переключить тему">Тема: Shire</button>
      <a class="btn" id="openCv" href="#cv-viewer" aria-controls="cv-viewer" aria-expanded="false">Посмотреть PDF</a>
    </div>
  </header>

  <!-- ФОНОВАЯ МУЗЫКА -->
  <audio id="bgAudio" preload="metadata" loop playsinline>
    <source src="assets/audio/The_Mines_of_Moria_The_Bridge_of_Khazad_Dûm,_from_Journy_in_th.mp3" type="audio/mpeg" />
  </audio>

  <main>
    <!-- HERO -->
    <section class="section hero" id="top">
      <div class="container">
        <article class="hero-card" data-reveal>
          <!-- Портрет с умным лоадером: пробуем набор путей, чтобы не споткнуться о пробелы/регистр -->
          <img class="portrait" id="portrait" src="assets/img/portrait.jpg" alt="Портрет в стиле Властелина колец" width="320" height="400" fetchpriority="high" decoding="async" data-preload>
          <div class="hero-body">
            <h1 class="title">Александр Елфимов</h1>
            <div class="motto">‹ ᛟ ᚠ ᚱ ᛟ ᚷ ᛁ ᚾ ᚷ ᛫ ᛟ ᚾ ᛖ ᛫ ᛟ ᚾ ᛖ ᛫ ᚱ ᛁ ᚾ ᚷ ᛫ ᛋ ᛁ ᚷ ᚾ ᛋ ›</div>
            <p class="subtitle">Аналитик данных / BI‑аналитик • Санкт‑Петербург</p>
            <div class="badges">
              <span class="badge">MS Excel</span>
              <span class="badge">Python</span>
              <span class="badge">Power BI</span>
              <span class="badge">SQL</span>
              <span class="badge">Power Query</span>
              <span class="badge">Data Lens</span>
            </div>
            <div class="cta">
              <a class="button is-primary" href="assets/cv.pdf" target="_blank" rel="noopener" id="cvBtn">Скачать PDF</a>
              <a class="button" href="#contacts">Связаться</a>
            </div>
          </div>
        </article>
      </div>
    </section>

    <!-- EXPERIENCE & EDUCATION -->
    <section class="section">
      <div class="container grid">
        <div class="card" data-reveal>
          <h2 class="h2">Опыт</h2>
          <article>
            <h3><strong>Мэлон Фэшн Груп</strong> — Младший бизнес‑аналитик <span style="opacity:.7">(Июн–Июл 2025)</span></h3>
            <ul class="list">
              <li>Выгрузка из 1С и обновление Excel‑отчётов по продажам, марже, каналам сбыта.</li>
              <li>Создал Excel‑дашборды (Power Query/Power Pivot) на данных из 1С, DWH и Data Lens.</li>
              <li>Собрал дашборд в Yandex Data Lens: подготовка данных и визуализации для еженедельного мониторинга.</li>
              <li>Ежедневно обновлял отчёты по план/факт и ключевым KPI.</li>
              <li>Строил прогнозы продаж/выручки/маржи по бренду в различных срезах.</li>
              <li>Проводил факторный анализ выручки, маржи, валового дохода по итогам месяца.</li>
            </ul>
          </article>
          <article style="margin-top:16px">
            <h3><strong>Технологии Доверия</strong> — Associate/Аналитик (ГУК) <span style="opacity:.7">(Ноя 2024 – Фев 2025)</span></h3>
            <ul class="list">
              <li>Модель динамического баланса для казначейства ТОП‑5 банка: прогноз кредитного портфеля, сценарии.</li>
              <li>Excel‑модели расчётов и структуры данных для повседневной работы казначейства.</li>
              <li>Согласование требований к данным, контроль целостности для промышленного масштаба модели.</li>
              <li>Выявление несоответствий, интеграция недостающих элементов данных.</li>
              <li>Презентации клиенту: структура модели, результаты, ключевые решения.</li>
            </ul>
          </article>
        </div>

        <div class="card" data-reveal>
          <h2 class="h2">Образование</h2>
          <p><strong>НИУ ВШЭ (Москва)</strong>, бакалавр экономики, 2024.</p>
          <hr style="border-color:var(--outline); opacity:.6; margin:16px 0">
          <h2 class="h2">Навыки</h2>
          <ul class="list" style="columns:2; column-gap:24px; padding-left:18px;">
            <li>MS Excel, Power Query/Power Pivot</li>
            <li>Power BI, Data Lens</li>
            <li>Python, SQL</li>
            <li>Матем. и стат. анализ</li>
            <li>Бизнес‑/финансовое моделирование</li>
            <li>Прогнозирование, факторный анализ</li>
            <li>Подготовка отчётов и презентаций</li>
            <li>Confluence, CRM, 1С</li>
            <li>Английский C1</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- ABOUT / DETAILS + KPI COUNTERS -->
    <section class="section">
      <div class="container grid">
        <div class="card" data-reveal>
          <h2 class="h2">Обо мне</h2>
          <p>Аналитик данных с упором на Excel/Power BI и Python/SQL. Люблю аккуратные модели, проверяемые гипотезы и понятные дашборды, которые помогают бизнесу принимать решения. Готов к гибкому графику и проектной работе. Есть РВП (разрешение на временное проживание).</p>
          <div class="badges" style="margin-top:10px">
            <span class="badge" data-count="12">12+ отчётов в проде</span>
            <span class="badge" data-count="8">8 дашбордов</span>
            <span class="badge" data-count="5">5 моделей прогноза</span>
          </div>
        </div>
        <div class="card kv" id="contacts" data-reveal>
          <div><strong>Город</strong></div><div>Санкт‑Петербург (м. Лесная)</div>
          <div><strong>Телефон</strong></div><div><a href="tel:+79818353073">+7 (981) 835‑30‑73</a></div>
          <div><strong>E‑mail</strong></div><div><a href="mailto:lucius.haze@mail.ru">lucius.haze@mail.ru</a> <button class="btn" id="copyEmail" style="margin-left:8px">Скопировать</button></div>
          <div><strong>Telegram</strong></div><div><a href="https://t.me/persiknalune_official" target="_blank" rel="noopener">@persiknalune_official</a></div>
          <div><strong>Гражданство</strong></div><div>Узбекистан, разрешение на работу в РФ</div>
        </div>
      </div>
    </section>

    <!-- RIBBON / ELVISH STENCIL PLACEHOLDER -->
    <section class="section" aria-hidden="true">
      <div class="container" data-reveal>
        <div class="card" style="display:grid; place-items:center; padding:40px; text-align:center;">
          <div style="font-family: ElvishRingNFI, Cinzel, serif; font-size: clamp(20px, 3.2vw, 34px); letter-spacing:.08em; color: var(--accent); text-shadow: 0 0 12px rgba(209,169,84,.35);">
            ‹ ᛟ ᚠ ᚱ ᛟ ᚷ ᛁ ᚾ ᚷ ᛫ ᛟ ᚾ ᛖ ᛫ ᛟ ᚾ ᛖ ᛫ ᚱ ᛁ ᚾ ᚷ ᛫ ᛋ ᛁ ᚷ ᚾ ᛋ ›
          </div>
          <small style="opacity:.7">(сюда подставьте ваш SVG/PNG трафарет: замените .leaves/.map в блоке PARALLAX выше на свои файлы)</small>
        </div>
      </div>
    </section>

    <!-- PDF VIEWER OVERLAY -->
    <section id="cv-viewer" hidden aria-hidden="true" style="position:fixed;inset:0;z-index:60;background:rgba(0,0,0,.7);backdrop-filter:blur(4px)">
      <div class="container" style="height:100%;display:grid;grid-template-rows:auto 1fr;gap:10px;padding:20px">
        <div style="display:flex;align-items:center;gap:10px;justify-content:space-between">
          <div class="h2">Резюме (PDF)</div>
          <div style="display:flex;gap:8px">
            <a class="button" href="assets/cv.pdf" download>Скачать</a>
            <button class="button" id="closeCv">Закрыть</button>
          </div>
        </div>
        <iframe src="assets/cv.pdf" title="Резюме PDF" style="width:100%;height:100%;border:1px solid var(--outline);border-radius:12px;background:#fff"></iframe>
      </div>
    </section>

  </main>

  <footer class="footer">
    <div class="container">Сделано с почтением к Профессору в эстетике Средиземья. © A. Elfimov</div>
  </footer>

  <!-- Back to top -->
  <div class="to-top" id="toTop"><a class="button" href="#top" aria-label="К началу">⬆︎ Наверх</a></div>

  <div class="texture" aria-hidden="true"></div>
  <div class="noise" aria-hidden="true"></div>

  <script>
    // ===== THEME TOGGLE (Shire ↔ Mordor) =====
    const themeToggle = document.getElementById('themeToggle');
    const applyTheme = (t)=>{
      document.body.setAttribute('data-theme', t);
      themeToggle.textContent = 'Тема: ' + (t === 'mordor' ? 'Mordor' : 'Shire');
      localStorage.setItem('lotr:theme', t);
    };
    const saved = localStorage.getItem('lotr:theme');
    applyTheme(saved || 'shire');
    themeToggle.addEventListener('click', ()=>{
      applyTheme(document.body.getAttribute('data-theme') === 'mordor' ? 'shire' : 'mordor');
    });

    // ===== AUDIO on first interaction + fade =====
    const audioEl = document.getElementById('bgAudio');
    const audioToggle = document.getElementById('audioToggle');
    let audioArmed = false; let userMuted = false; audioEl.volume = 0.0; // мягкий старт
    function setAudioLabel(){ const on = !audioEl.paused && !audioEl.muted; audioToggle.textContent = 'Звук: ' + (on ? 'Вкл' : 'Выкл'); }
    function armAndPlay(){ if (audioArmed) return; audioArmed = true; audioEl.play().then(()=>{ setAudioLabel(); fadeAudio(0.35, 800); }).catch(()=>{}); cleanupArm(); }
    function cleanupArm(){ window.removeEventListener('pointerdown', armAndPlay, true); window.removeEventListener('keydown', armAndPlay, true); window.removeEventListener('touchstart', armAndPlay, true); }
    window.addEventListener('pointerdown', armAndPlay, true); window.addEventListener('keydown', armAndPlay, true); window.addEventListener('touchstart', armAndPlay, true);
    audioToggle.addEventListener('click', ()=>{ if (audioEl.paused){ audioEl.play().then(()=>fadeAudio(0.35, 300)); } else { fadeAudio(0.0, 300, ()=>audioEl.pause()); } userMuted = audioEl.paused; setAudioLabel(); });
    document.addEventListener('visibilitychange', ()=>{ if(document.hidden){ if(!audioEl.paused) audioEl.pause(); } else { if(!userMuted) audioEl.play().catch(()=>{}); } setAudioLabel(); });
    function fadeAudio(target, dur, cb){ const start = audioEl.volume; const t0 = performance.now(); const step = (t)=>{ const p = Math.min(1, (t - t0)/dur); audioEl.volume = start + (target - start)*p; if(p<1) requestAnimationFrame(step); else cb && cb(); }; requestAnimationFrame(step); }

    // ===== Robust PRELOADER (anti-freeze) + fade-in audio on hide =====
    const pre = document.getElementById('preloader');
    const bar = document.getElementById('progressBar');
    const num = document.getElementById('progressNum');
    const assets = Array.from(document.querySelectorAll('[data-preload]'));
    let loaded = 0; let visualP = 0; let hidden = false;
    function setProgress(p){ visualP = Math.max(visualP, p); bar.style.width = visualP + '%'; num.textContent = Math.round(visualP); }
    (function tick(){ if(hidden) return; visualP += (95 - visualP) * 0.06; setProgress(visualP); requestAnimationFrame(tick); })();
    function updateByAssets(){ const total = Math.max(assets.length, 1); const base = Math.round((loaded / total) * 80); setProgress(base); }
    assets.forEach(img => { if (img.complete) { loaded++; updateByAssets(); } else { img.addEventListener('load', ()=>{ loaded++; updateByAssets(); }); img.addEventListener('error', ()=>{ loaded++; updateByAssets(); }); } });
    const withTimeout = (p, ms) => new Promise(res => { let done=false; const t=setTimeout(()=>{ if(!done) res('timeout'); }, ms); Promise.resolve(p).then(()=>{done=true;clearTimeout(t);res('ok')}).catch(()=>{done=true;clearTimeout(t);res('err')}); });
    const fontsReady = (document.fonts ? document.fonts.ready : Promise.resolve());
    const windowLoaded = new Promise(r => { if (document.readyState === 'complete') r(); else window.addEventListener('load', r, { once:true }); });
    Promise.all([ withTimeout(fontsReady, 3500), withTimeout(windowLoaded, 6000) ]).then(()=> forceHide()).catch(()=> forceHide());
    const killer = setTimeout(()=> forceHide(), 8000);
    function forceHide(){ if(hidden) return; hidden = true; clearTimeout(killer); setProgress(100); pre.classList.add('hidden'); if(audioArmed && !userMuted){ fadeAudio(0.35, 1000); } }
    pre.addEventListener('transitionend', (e)=>{ if(e.propertyName === 'opacity' && pre.classList.contains('hidden')){ pre.style.display = 'none'; pre.setAttribute('aria-hidden','true'); } });

    // ===== REVEAL on scroll =====
    const io = new IntersectionObserver((entries)=>{ entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('revealed'); io.unobserve(e.target); } }); }, { threshold: .18 });
    document.querySelectorAll('[data-reveal]').forEach(el=> io.observe(el));

    // ===== SIMPLE PARALLAX for stencils =====
    const layers = document.querySelectorAll('.p-layer');
    function parallax(){ const y = window.scrollY || 0; layers.forEach((el, i)=>{ const depth = i===0?20:40; el.style.transform = `translate3d(0, ${y/depth}px, 0)`; }); }
    window.addEventListener('scroll', parallax, { passive:true }); parallax();

    // ===== SMART PORTRAIT LOADER (простит пробелы/регистр/расширения/кириллицу) =====
    const portrait = document.getElementById('portrait');
    const candidates = [
      'assets/img/саня%20властелин%20колец.png',
      'assets/img/саня властелин колец.png',
      'assets/img/Саня%20властелин%20колец.png',
      'assets/img/саня%20властелин%20колец.PNG',
      'assets/img/саня%20властелин%20колец.jpg',
      'assets/img/саня%20властелин%20колец.jpeg',
      'assets/img/portrait.jpg'
    ];
    function tryNext(i=0){ if(i>=candidates.length) return; const test = new Image(); test.onload=()=>{ portrait.src = candidates[i]; }; test.onerror=()=>tryNext(i+1); test.src = candidates[i]; }
    // если дефолтный портрет не ваш — попробуем найти файл с названием из ТЗ
    tryNext();

    // ===== KPI counters animation =====
    const counters = document.querySelectorAll('[data-count]');
    const io2 = new IntersectionObserver((es)=>{ es.forEach(e=>{ if(e.isIntersecting){ const el = e.target; const target = parseInt(el.getAttribute('data-count')); let val = 0; const t0 = performance.now(); const step = (t)=>{ const p = Math.min(1, (t-t0)/800); val = Math.floor(target * p); el.textContent = (target>=10? target+'+': target); }; const id = setInterval(()=>{}, 0); // dummy
      const raf = ()=>{ const t = performance.now(); const p = Math.min(1, (t-t0)/800); el.textContent = Math.floor(target * p) + (target>=10?'+':''); if(p<1) requestAnimationFrame(raf); else io2.unobserve(el); }; requestAnimationFrame(raf); } }); }, { threshold:.6 });
    counters.forEach(b=> io2.observe(b));

    // ===== Back to top visibility =====
    const toTop = document.getElementById('toTop');
    const toTopIO = new IntersectionObserver((es)=>{ es.forEach(e=>{ toTop.classList.toggle('show', !e.isIntersecting); }); }, { threshold:0 });
    toTopIO.observe(document.querySelector('.hero'));

    // ===== CV viewer overlay =====
    const cvSection = document.getElementById('cv-viewer');
    const openCv = document.getElementById('openCv');
    const closeCv = document.getElementById('closeCv');
    openCv.addEventListener('click', (ev)=>{ ev.preventDefault(); cvSection.hidden = false; cvSection.setAttribute('aria-hidden','false'); openCv.setAttribute('aria-expanded','true'); history.pushState({}, '', '#cv-viewer'); });
    closeCv.addEventListener('click', ()=>{ cvSection.hidden = true; cvSection.setAttribute('aria-hidden','true'); openCv.setAttribute('aria-expanded','false'); if(location.hash === '#cv-viewer'){ history.back(); } });
    window.addEventListener('popstate', ()=>{ if(location.hash !== '#cv-viewer'){ cvSection.hidden = true; cvSection.setAttribute('aria-hidden','true'); openCv.setAttribute('aria-expanded','false'); } });

    // ===== copy email =====
    document.getElementById('copyEmail').addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText('lucius.haze@mail.ru'); alert('E‑mail скопирован'); }catch(e){ /* noop */ }
    });
  </script>
</body>
</html>
